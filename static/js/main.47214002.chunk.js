(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{161:function(e,t,n){e.exports=n(296)},166:function(e,t,n){},296:function(e,t,n){"use strict";n.r(t);var a=n(2),r=n.n(a),o=n(64),i=n.n(o),l=(n(166),n(131)),c=n(132),d=n(233),s=n(133),f=n(235),m=n(306),h=n(305),u=n(307),g=n(234),w=window.daikon,v={borderWidth:2,borderColor:"#666",borderStyle:"dashed",borderRadius:5,width:600,height:150,textAlign:"center"},p=function(e){function t(e){var n;return Object(l.a)(this,t),(n=Object(d.a)(this,Object(s.a)(t).call(this,e))).handleChange=function(e,t){"center"===t.value?n.setState({ifWindowCenterMode:!0}):n.setState({ifWindowCenterMode:!1}),n.currentImage&&n.switchFrame(n.currentImage,n.state.currentIndex)},n.renderImage=function(e){if(console.log("renderImage bytelength:",e.byteLength),e){w.Parser.verbose=!0;var t=w.Series.parseImage(new DataView(e)),a=t.getNumberOfFrames();if(a>1){var r="It is multi-frame file (n=".concat(a,")");n.setState({fileInfo:r})}else n.setState({fileInfo:""});n.setState({frameIndexes:Array.from({length:a},function(e,t){return{text:t,value:t}}),currentIndex:0}),n.currentImage=t,n.switchFrame(n.currentImage,0)}},n.switchFrame=function(e,t){console.log("switch to ".concat(t," Frame"));var a=!1,r=0,o=e.getPhotometricInterpretation(),i=e.getModality();if(null!==o){var l=e.getPlanarConfig();console.log("Planar mode:",l),-1!==o.trim().indexOf("RGB")?(a=!0,r=e.getPlanarConfig()||0):-1!==o.trim().toLowerCase().indexOf("palette")&&(a=!0)}var c,d,s=e.getInterpretedData(!1,!0,t),f=s.numCols,m=s.numRows,h=e.getWindowCenter(),u=e.getWindowWidth();if(n.setState({windowCenter:h,windowWidth:u,max:s.max,min:s.min,resX:f,resY:m,modality:i,photometric:o}),n.state.ifWindowCenterMode)if(h&&u){d=h-Math.floor(u/2),c=h+Math.floor(u/2);for(var g=0;g<s.data.length;g+=1)s.data[g]>c?s.data[g]=c:s.data[g]<d&&(s.data[g]=d)}else console.log("no valid window center/width"),c=s.max,d=s.min;else c=s.max,d=s.min;if(n.myCanvasRef.current){var w=document.createElement("canvas");w.width=f,w.height=m;var v=w.getContext("2d"),p=v.createImageData(f,m),y=p.data;if(a)if(0===r)for(var x=s.data,C=0,I=0;C<y.byteLength;C+=1,I+=1)y[C]=x[I],(C+2)%4===0&&(y[C+1]=255,C+=1);else for(var b=s.data,E=b.length/3,F=0,M=0;F<y.byteLength;F+=1,M+=1){var R=Math.floor(F/4);(F+1)%4===1?y[F]=b[R]:(F+1)%4===2?y[F]=b[R+E]:(F+1)%4===3&&(y[F]=b[R+2*E],y[F+1]=255,F+=1)}else{for(var S=c-d,W=new Uint8ClampedArray(s.data.length),D=0;D<s.data.length;D+=1)W[D]=255*(s.data[D]-d)/S;for(var O=0,k=0;O<y.byteLength;O+=4,k+=1)y[O]=W[k],y[O+1]=W[k],y[O+2]=W[k],y[O+3]=255}v.putImageData(p,0,0);var j=n.resizeTotFit(f,m);1!==j&&console.log("scale:",j);var L=n.myCanvasRef.current;L.width=f/j,L.height=m/j,L.getContext("2d").drawImage(w,0,0,L.width,L.height)}else console.log("this.myCanvasRef is not ready, return")},n.fetchFile=function(e){if(0===e.indexOf("file://")){var t=new XMLHttpRequest;t.open("GET",e,!0),t.responseType="arraybuffer",t.onload=function(){var e=t.response;n.renderImage(e)},t.send()}else{console.log("Starting XHR request for",e);var a=new XMLHttpRequest;a.open("GET",e,!1),a.overrideMimeType("text/plain; charset=x-user-defined"),a.send(),console.log("Finished XHR request");var r,o,i,l=a.responseText;r=new ArrayBuffer(l.length),o=new DataView(r),l.split("").forEach(function(e,t){i=e.charCodeAt(),o.setUint8(t,255&i)});var c=o.buffer;n.renderImage(c)}},n.onDropFile=function(e){if(e.length>0){var t=e[0];n.setState({filePath:t.name});var a=new FileReader;a.onload=function(){try{var e=a.result;n.renderImage(e)}catch(t){console.log("parse dicom error:",t)}},a.onabort=function(){return console.log("file reading was aborted")},a.onerror=function(){return console.log("file reading has failed")},a.readAsArrayBuffer(t)}},n.handleSwitchFrame=function(e,t){var a=t.value;console.log("switch frame:",a),n.setState({currentIndex:a}),n.switchFrame(n.currentImage,a)},n.state={filePath:"",fileInfo:"",currentIndex:0,frameIndexes:[],ifWindowCenterMode:!0,windowCenter:"",windowWidth:"",max:"",min:"",resX:"",resY:"",photometric:"",modality:""},n.myCanvasRef=r.a.createRef(),n}return Object(f.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){var e=window.location.href;if(-1!==e.toLowerCase().indexOf(".dcm")||-1!==e.toLowerCase().indexOf(".dicom")){var t=e.split("#");if(t.length>1){var n=t[1];this.setState({filePath:n}),this.fetchFile(n)}}}},{key:"resizeTotFit",value:function(e,t){var n=1,a=1280,r=1024;if(e<=a&&t<=r)return n;var o=e/a,i=t/r;return n=o>=i?o:i}},{key:"render",value:function(){var e=this.state,t=e.filePath,n=e.fileInfo,a=e.frameIndexes,o=e.currentIndex,i=e.ifWindowCenterMode,l=e.windowCenter,c=e.windowWidth,d=e.max,s=e.min,f=e.resX,w=e.resY,p=e.photometric,y=e.modality,x="[Info]";return x+=" modality:".concat(y,";photometric:").concat(p),f&&w&&(x+=" resolution:".concat(f,"x").concat(w)),r.a.createElement("div",{className:"flex-container"},r.a.createElement("div",null,r.a.createElement("div",null,"DICOM Image Viewer "),r.a.createElement("div",null,r.a.createElement(g.a,{preventDropOnDocument:!1,style:v,onDrop:this.onDropFile},r.a.createElement("div",{style:{height:"100%",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center"}},r.a.createElement("div",null,r.a.createElement("p",null," ","Try dropping DICOM image files here, ",r.a.createElement("br",null),"or click here to select files to view.")))),x,r.a.createElement(m.a,null,r.a.createElement(m.a.Field,null,r.a.createElement(h.a,{radio:!0,label:"Window Center Mode (default)",name:"checkboxRadioGroup",value:"center",checked:i,onChange:this.handleChange})," c:".concat(l,";w:").concat(c)),r.a.createElement(m.a.Field,null,r.a.createElement(h.a,{radio:!0,label:"Max/Min Mode",name:"checkboxRadioGroup",value:"max",checked:!i,onChange:this.handleChange})," max:".concat(d,";min:").concat(s)))),r.a.createElement("div",{style:{display:"flex",justifyContent:"center"}}," ",t||null," ")," ",r.a.createElement("div",{style:{display:"flex",justifyContent:"center"}},r.a.createElement("div",null," ",n||null," ")," ",r.a.createElement("div",null," ",a.length>1?r.a.createElement(u.a,{placeholder:"Switch Frame",selection:!0,onChange:this.handleSwitchFrame,options:a,value:o}):null," ")," ")," ",r.a.createElement("div",{style:{display:"flex",justifyContent:"center"}},r.a.createElement("canvas",{ref:this.myCanvasRef,width:128,height:128}))," "))}}]),t}(a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(r.a.createElement(p,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[161,2,1]]]);
//# sourceMappingURL=main.47214002.chunk.js.map